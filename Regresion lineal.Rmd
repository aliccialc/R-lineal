---
title: "Regresion lineal"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, eval = TRUE, fig.height = 4, fig.width = 4, fig.align = 'center', message = TRUE, cache = TRUE)
```

```{r library, eval=FALSE}
library('TH.data')
library('car')
library('MASS')
library('lmtest')
library('faraway')
library('GGally')
```
# Introducción

Los datos de este estudio se pueden incorporar a R desde el data.frame bodyfat del paquete TH.data.

Las variables del estudio son:

· age es la edad en años.

· DEXfat es la grasa corporal medida con DXA, variable respuesta.

· waistcirc es la circunferencia de la cintura.

· hipcirc es el perímetro de la cadera.

· elbowbreadth es la anchura del codo.

· kneebreadth es la anchura de la rodilla.

· anthro3a es la suma del logaritmo de tres medidas antropométricas.

· anthro3b es la suma del logaritmo de tres medidas antropométricas.

· anthro3c es la suma del logaritmo de tres medidas antropométricas.

· anthro4 es la suma del logaritmo de tres medidas antropométricas.

# Exploración de los datos

Primera observación de las variables, vemos que todas son numéricas.
```{r variables}
data("bodyfat")
str(bodyfat)
```
A continuación vemos un resumen de los resultados, para confirmar que no vemos raro en los datos.
```{r summary}
summary(bodyfat)
```

## Gráficas y calculo de la matriz de correlaciones entre variables 2 a 2

En la figura 1 podemos ver la correlación entre las variantes. La correlación mide la relación lineal entre dos variables. Si nos dirigimos a la segunda fila, vemos la relación de DEXfat con el resto de variables, observamos una correlación positiva. Las variables con menor correlación son age con un 0,271 y elbowbreadth con un 0,354. 

```{r grafica1, fig.cap= "Gráfico de dispersión, densidad y correlación. *** significa estadísticamente significativa}
ggpairs(bodyfat)
```

## Estudio de VIF

Es muy frecuente que varias variables explicativas estén correlacionadas. Para confirmar que hay multicolinealidad, esta relación debe ser fuerte (>0.8) pero no perfecta (1). Esto lo hemos podido comprobar en la gráfica anterior.

Hay varias formas de detectar la multicolinealidad. Una de ellas es viendo si R2 es alta, pero los coeficientes t´s no son significativos. Para ello podemos ver el resumen de la regresión lineal. En este caso podemos sospechar porque nos encontramos con un R2 de 0.9117 y con solo 3 de las 9 variables con resultado significativo.
```{r}
lmod <- lm(DEXfat ~., bodyfat)
summary(lmod)
```

Otra forma es mediante el Factor de Influencia de la Varianza (VIF). Es una medida del grado en que la varianza del estimador de mínimos cuadrados se incrementa por esta colinealidad.
Podemos situar la correlación mayor a 0.8 a partir de 5vif y 0.9 con 10vif. Por lo tanto todos mayores, podemos empezar a pensar que existe multicolinealidad. Por lo tanto, podríamos decir que son las cuatro últimas variables las que presentan multicolinealidad.

```{r}
vif(lmod)
```

